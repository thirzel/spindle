<?php
// This script and data application were generated by AppGini 5.31
// Download AppGini for free from http://bigprof.com/appgini/download/

	$currDir=dirname(__FILE__);
	include("$currDir/defaultLang.php");
	include("$currDir/language.php");
	include("$currDir/lib.php");

	header("Content-type: text/javascript; charset=UTF-8");

	$mfk=$_GET['mfk'];
	$id=makeSafe($_GET['id']);
	$rnd1=intval($_GET['rnd1']); if(!$rnd1) $rnd1='';

	if(!$mfk){
		die('// no js code available!');
	}

	switch($mfk){

		case 'agent':
			if(!$id){
				?>
				$('story_character<?php echo $rnd1; ?>').innerHTML='&nbsp;';
				<?php
				break;
			}
			$res = sql("SELECT `story_characters`.`id` as 'id', IF(    CHAR_LENGTH(`story1`.`id`) || CHAR_LENGTH(`story1`.`story`), CONCAT_WS('',   `story1`.`id`, '  ', `story1`.`story`), '') as 'story', IF(    CHAR_LENGTH(`class_dramatica_archetype1`.`archetype`), CONCAT_WS('',   `class_dramatica_archetype1`.`archetype`), '') as 'role', `story_characters`.`character` as 'character', IF(    CHAR_LENGTH(`biblio_author1`.`memberID`), CONCAT_WS('',   `biblio_author1`.`memberID`), '') as 'memberID', IF(    CHAR_LENGTH(`biblio_author1`.`last_name`) || CHAR_LENGTH(`biblio_author1`.`first_name`), CONCAT_WS('',   `biblio_author1`.`last_name`, ', ', `biblio_author1`.`first_name`), '') as 'agent_name', `story_characters`.`cw_name` as 'cw_name', IF(    CHAR_LENGTH(`biblio_author1`.`img`), CONCAT_WS('',   `biblio_author1`.`img`), '') as 'img', `story_characters`.`MC_resolve` as 'MC_resolve', `story_characters`.`MC_growth` as 'MC_growth', `story_characters`.`MC_approach` as 'MC_approach', `story_characters`.`MC_PS_style` as 'MC_PS_style', `story_characters`.`cw_age` as 'cw_age', `story_characters`.`cw_gender` as 'cw_gender', `story_characters`.`cw_communication_style` as 'cw_communication_style', `story_characters`.`cw_background` as 'cw_background', `story_characters`.`cw_appearance` as 'cw_appearance', `story_characters`.`cw_relationships` as 'cw_relationships', `story_characters`.`cw_ambition` as 'cw_ambition', `story_characters`.`cw_character_defects` as 'cw_character_defects', `story_characters`.`cw_thoughts` as 'cw_thoughts', `story_characters`.`cw_relatedness` as 'cw_relatedness', `story_characters`.`cw_restrictions` as 'cw_restrictions', `story_characters`.`locations` as 'locations', `story_characters`.`persons` as 'persons', `story_characters`.`events` as 'events', IF(    CHAR_LENGTH(`class_nt1`.`noetictension`), CONCAT_WS('',   `class_nt1`.`noetictension`), '') as 'noetictension', IF(    CHAR_LENGTH(`class_im1`.`impression`), CONCAT_WS('',   `class_im1`.`impression`), '') as 'impression' FROM `story_characters` LEFT JOIN `story` as story1 ON `story1`.`id`=`story_characters`.`story` LEFT JOIN `class_dramatica_archetype` as class_dramatica_archetype1 ON `class_dramatica_archetype1`.`id`=`story_characters`.`role` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`story_characters`.`agent_name` LEFT JOIN `class_nt` as class_nt1 ON `class_nt1`.`id`=`story_characters`.`noetictension` LEFT JOIN `class_im` as class_im1 ON `class_im1`.`id`=`story_characters`.`impression`  WHERE `story_characters`.`id`='$id' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$('story_character<?php echo $rnd1; ?>').innerHTML = '<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['role'].'- '.$row['character']))); ?>&nbsp;';
			<?php
			break;

		case 'token':
			if(!$id){
				?>
				$('token_sequence<?php echo $rnd1; ?>').innerHTML='&nbsp;';
				<?php
				break;
			}
			$res = sql("SELECT `biblio_token`.`id` as 'id', IF(    CHAR_LENGTH(`biblio_author1`.`memberID`) || CHAR_LENGTH(`biblio_author1`.`last_name`), CONCAT_WS('',   `biblio_author1`.`memberID`, '  ', `biblio_author1`.`last_name`), '') as 'author', IF(    CHAR_LENGTH(`biblio_doc1`.`id`) || CHAR_LENGTH(`biblio_doc1`.`title`), CONCAT_WS('',   `biblio_doc1`.`id`, '  ', `biblio_doc1`.`title`), '') as 'bibliography', IF(    CHAR_LENGTH(`biblio_trascript1`.`trascriber_memberID`) || CHAR_LENGTH(`biblio_trascript1`.`transcript_title`), CONCAT_WS('',   `biblio_trascript1`.`trascriber_memberID`, '- ', `biblio_trascript1`.`transcript_title`), '') as 'transcript', `biblio_token`.`token_sequence` as 'token_sequence', `biblio_token`.`token` as 'token' FROM `biblio_token` LEFT JOIN `biblio_author` as biblio_author1 ON `biblio_author1`.`id`=`biblio_token`.`author` LEFT JOIN `biblio_doc` as biblio_doc1 ON `biblio_doc1`.`id`=`biblio_token`.`bibliography` LEFT JOIN `biblio_trascript` as biblio_trascript1 ON `biblio_trascript1`.`id`=`biblio_token`.`transcript`  WHERE `biblio_token`.`id`='$id' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$('token_sequence<?php echo $rnd1; ?>').innerHTML = '<?php echo addslashes(str_replace(array("\r", "\n"), '', nl2br($row['id']))); ?>&nbsp;';
			<?php
			break;


	}

?>